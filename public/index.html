<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ‡¸ğŸ‡¦ Ø´Ø§Øª Ø¹Ø±Ø¨ÙŠ Ù…ØªÙƒØ§Ù…Ù„ - Ø¯Ø±Ø¯Ø´Ø©ØŒ ØµÙˆØ±ØŒ ØµÙˆØª</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2E7D32;
            --secondary: #4CAF50;
            --light: #f8f9fa;
            --dark: #343a40;
            --warning: #ff9800;
            --danger: #dc3545;
            --owner-color: #FFD700;
            --minister-color: #9370DB;
            --member-color: #6c757d;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Arial', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        /* Ù†Ø§ÙØ°Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .modal-content h2, .modal-content h3 {
            color: var(--primary);
            margin-bottom: 20px;
        }
        
        /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØµÙˆØ± Ø§Ù„Ø´Ø®ØµÙŠØ© */
        .avatar-options {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .avatar-option {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.3s;
            background: #f8f9fa;
        }
        
        .avatar-option:hover {
            transform: scale(1.1);
        }
        
        .avatar-option.selected {
            border-color: var(--primary);
            background: #e8f5e9;
        }
        
        .avatar-option img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
        }
        
        /* Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª */
        input[type="text"], input[type="file"] {
            width: 100%;
            padding: 12px 15px;
            margin: 10px 0;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
        }
        
        input[type="text"]:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
        button {
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            margin: 5px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(46, 125, 50, 0.3);
        }
        
        button:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
        }
        
        button.danger {
            background: linear-gradient(90deg, #dc3545, #c82333);
        }
        
        button.warning {
            background: linear-gradient(90deg, #ff9800, #f57c00);
        }
        
        button.owner-btn {
            background: linear-gradient(90deg, var(--owner-color), #FFC107);
            color: #000;
        }
        
        button.minister-btn {
            background: linear-gradient(90deg, var(--minister-color), #8A2BE2);
        }
        
        /* Ø±Ù…ÙˆØ² Ø§Ù„Ø±ØªØ¨ */
        .role-badge {
            font-size: 11px;
            padding: 2px 8px;
            border-radius: 10px;
            margin-right: 5px;
            font-weight: bold;
        }
        
        .role-owner {
            background: var(--owner-color);
            color: #000;
        }
        
        .role-minister {
            background: var(--minister-color);
            color: white;
        }
        
        .role-member {
            background: var(--member-color);
            color: white;
        }
        
        /* ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø´Ø§Øª */
        .chat-app {
            width: 100%;
            max-width: 1200px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 95vh;
        }
        
        .header {
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 5px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 14px;
        }
        
        .user-profile {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(255,255,255,0.2);
            padding: 8px 15px;
            border-radius: 50px;
            cursor: pointer;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            overflow: hidden;
        }
        
        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .user-role-display {
            font-size: 12px;
            background: rgba(255,255,255,0.3);
            padding: 2px 8px;
            border-radius: 10px;
            margin-right: 5px;
        }
        
        /* Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª */
        .stats {
            background: #e8f5e9;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #c8e6c9;
            color: var(--primary);
            font-weight: bold;
        }
        
        .stats div {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }
        
        /* Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ */
        .sidebar {
            width: 300px;
            background: #f8f9fa;
            border-left: 1px solid #dee2e6;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .sidebar-section {
            background: white;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #dee2e6;
        }
        
        .sidebar-section h3 {
            color: var(--primary);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e8f5e9;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† */
        #usersList {
            list-style: none;
            max-height: 300px;
            overflow-y: auto;
        }
        
        #usersList li {
            padding: 10px 12px;
            margin-bottom: 8px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #dee2e6;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: background 0.3s;
        }
        
        #usersList li:hover {
            background: #e8f5e9;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
        }
        
        .user-avatar-small {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            overflow: hidden;
            flex-shrink: 0;
        }
        
        .user-avatar-small img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .user-details {
            flex: 1;
            min-width: 0;
        }
        
        .user-name-role {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-bottom: 3px;
        }
        
        .user-name {
            font-weight: bold;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .user-status {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #28a745;
            flex-shrink: 0;
        }
        
        .user-status.muted {
            background: #dc3545;
        }
        
        .promoted-by {
            color: #6c757d;
            font-size: 10px;
            display: block;
        }
        
        .user-actions {
            display: flex;
            gap: 3px;
            flex-shrink: 0;
        }
        
        .user-actions button {
            width: 30px;
            height: 30px;
            padding: 0;
            border-radius: 50%;
            font-size: 12px;
            margin: 0;
        }
        
        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© */
        .chat-area {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        /* Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ */
        #messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: #f8f9fa;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .message {
            background: white;
            padding: 15px;
            border-radius: 15px;
            border: 1px solid #e0e0e0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            max-width: 80%;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .message.own {
            margin-right: auto;
            background: #e3f2fd;
            border-color: #bbdefb;
        }
        
        .message.other {
            margin-left: auto;
            background: #f1f8e9;
            border-color: #dcedc8;
        }
        
        .message.system {
            max-width: 100%;
            background: #fff3e0;
            border-color: #ffe0b2;
            text-align: center;
            font-style: italic;
        }
        
        .message.reply {
            border-right: 4px solid var(--primary);
        }
        
        .message-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .message-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            overflow: hidden;
            flex-shrink: 0;
        }
        
        .message-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .message-user {
            font-weight: bold;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .message-time {
            color: #666;
            font-size: 12px;
            margin-right: auto;
        }
        
        .message-content {
            margin: 10px 0;
            line-height: 1.5;
        }
        
        .message-text {
            font-size: 15px;
            word-break: break-word;
        }
        
        .message-reply {
            background: rgba(0,0,0,0.05);
            padding: 8px 12px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-right: 3px solid var(--primary);
            font-size: 14px;
            color: #666;
        }
        
        .message-reply small {
            display: block;
            color: #999;
            font-size: 12px;
        }
        
        /* Ø§Ù„Ù…Ù„ÙØ§Øª */
        .message-file {
            margin-top: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .file-preview {
            max-width: 300px;
            max-height: 200px;
            object-fit: contain;
            background: #000;
        }
        
        .file-info {
            padding: 10px;
            background: #f8f9fa;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .file-info i {
            font-size: 24px;
            color: var(--primary);
        }
        
        /* Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØµÙˆØªÙŠØ© */
        .voice-message {
            margin-top: 10px;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .voice-player {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .voice-duration {
            font-size: 12px;
            color: #666;
            min-width: 40px;
        }
        
        /* Ù…Ø¤Ø´Ø± Ø§Ù„ÙƒØªØ§Ø¨Ø© */
        .typing-indicator {
            padding: 10px 20px;
            color: #666;
            font-style: italic;
            font-size: 14px;
            background: #f8f9fa;
            border-top: 1px solid #dee2e6;
            display: none;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
        .input-area {
            padding: 20px;
            background: white;
            border-top: 1px solid #dee2e6;
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .input-tools {
            display: flex;
            gap: 5px;
        }
        
        .input-tools button {
            width: 40px;
            height: 40px;
            padding: 0;
            border-radius: 50%;
        }
        
        #messageInput {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
            min-height: 20px;
            max-height: 100px;
            overflow-y: auto;
            resize: none;
        }
        
        #messageInput:focus {
            outline: none;
            border-color: var(--secondary);
        }
        
        /* ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØµÙˆØª */
        .recording-indicator {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(220, 53, 69, 0.9);
            color: white;
            padding: 20px 30px;
            border-radius: 15px;
            display: none;
            align-items: center;
            gap: 15px;
            z-index: 2000;
            animation: recordingPulse 1s infinite;
        }
        
        @keyframes recordingPulse {
            0%, 100% { box-shadow: 0 0 20px rgba(220, 53, 69, 0.5); }
            50% { box-shadow: 0 0 40px rgba(220, 53, 69, 0.8); }
        }
        
        /* Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }
            
            .chat-app {
                height: 100vh;
                border-radius: 0;
            }
            
            body {
                padding: 0;
            }
            
            .message {
                max-width: 90%;
            }
            
            .modal-content {
                width: 95%;
            }
            
            .user-profile span {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- ========== Ù†Ø§ÙØ°Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ========== -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <h2><i class="fas fa-door-open"></i> Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ø´Ø§Øª</h2>
            <input type="text" id="usernameInput" placeholder="Ø§Ø³Ù…Ùƒ ÙÙŠ Ø§Ù„Ø´Ø§Øª" value="Ø²Ø§Ø¦Ø±" maxlength="20">
            
            <h3><i class="fas fa-user-circle"></i> Ø§Ø®ØªØ± ØµÙˆØ±ØªÙƒ</h3>
            <div class="avatar-options">
                <div class="avatar-option selected" data-avatar="ğŸ‘¤">ğŸ‘¤</div>
                <div class="avatar-option" data-avatar="ğŸ‘‘">ğŸ‘‘</div>
                <div class="avatar-option" data-avatar="ğŸ¦">ğŸ¦</div>
                <div class="avatar-option" data-avatar="ğŸ¯">ğŸ¯</div>
                <div class="avatar-option" data-avatar="ğŸ¦Š">ğŸ¦Š</div>
                <div class="avatar-option" data-avatar="ğŸ¦‰">ğŸ¦‰</div>
                <div class="avatar-option" id="customAvatarBtn" title="Ø±ÙØ¹ ØµÙˆØ±Ø©">
                    <i class="fas fa-plus"></i>
                </div>
            </div>
            
            <input type="file" id="avatarUploadInput" accept="image/*" style="display: none;">
            <div id="avatarPreview" style="margin: 15px 0; display: none;">
                <div class="avatar-option selected" style="width: 80px; height: 80px; margin: 0 auto;">
                    <img id="previewImage" src="" alt="Ù…Ø¹Ø§ÙŠÙ†Ø©">
                </div>
            </div>
            
            <button onclick="completeLogin()" style="width:100%; padding:15px; margin-top:15px;">
                <i class="fas fa-sign-in-alt"></i> Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ø´Ø§Øª
            </button>
            
            <p style="margin-top:15px; color:#666; font-size:14px;">
                <strong>Ù…Ù„Ø§Ø­Ø¸Ø©:</strong> Ø³Ø¬Ù„ Ø¨Ø§Ø³Ù… "Ø§Ù„Ù…Ø§Ù„Ùƒ" Ù„ØªÙƒÙˆÙ† ØµØ§Ø­Ø¨ Ø§Ù„Ù…ÙˆÙ‚Ø¹
            </p>
        </div>
    </div>
    
    <!-- ========== ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø´Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ========== -->
    <div class="chat-app" style="display: none;" id="chatApp">
        <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
        <div class="header">
            <div class="user-profile" onclick="toggleProfileMenu()">
                <div class="user-avatar" id="headerAvatar">
                    ğŸ‘¤
                </div>
                <div>
                    <span id="headerUsername">Ø²Ø§Ø¦Ø±</span>
                    <div class="user-role-display" id="headerRole" style="display: none;"></div>
                </div>
            </div>
            <h1><i class="fas fa-comments"></i> Ø´Ø§Øª Ø¹Ø±Ø¨ÙŠ - Ù†Ø¸Ø§Ù… Ø§Ù„Ø±ØªØ¨</h1>
            <p>Ù…Ø§Ù„Ùƒ ğŸ† | ÙˆØ²Ø±Ø§Ø¡ ğŸ‘‘ | Ø£Ø¹Ø¶Ø§Ø¡ ğŸ‘¤</p>
        </div>
        
        <!-- Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
        <div class="stats">
            <div>
                <i class="fas fa-users"></i>
                <span id="onlineCount">0</span> Ù…ØªØµÙ„ÙˆÙ†
            </div>
            <div>
                <i class="fas fa-wifi"></i>
                <span id="connectionStatus">Ø¬Ø§Ø±Ù Ø§Ù„Ø§ØªØµØ§Ù„...</span>
            </div>
            <div>
                <i class="fas fa-crown"></i>
                <span id="userRoleDisplay">...</span>
            </div>
        </div>
        
        <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
        <div class="main-content">
            <!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ -->
            <div class="sidebar">
                <!-- Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ø§Ù„Ù…ØªØµÙ„ÙˆÙ† -->
                <div class="sidebar-section">
                    <h3><i class="fas fa-user-friends"></i> Ø§Ù„Ù…ØªØµÙ„ÙˆÙ† Ø§Ù„Ø¢Ù†</h3>
                    <ul id="usersList">
                        <li>Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</li>
                    </ul>
                </div>
                
                <!-- Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ -->
                <div class="sidebar-section">
                    <h3><i class="fas fa-user-cog"></i> Ù…Ù„ÙÙƒ Ø§Ù„Ø´Ø®ØµÙŠ</h3>
                    <div style="text-align: center; margin-bottom: 15px;">
                        <div class="user-avatar" id="sidebarAvatar" style="width: 80px; height: 80px; margin: 0 auto 10px; font-size: 40px;">
                            ğŸ‘¤
                        </div>
                        <strong id="sidebarUsername">Ø²Ø§Ø¦Ø±</strong>
                        <div id="sidebarRole" style="margin-top:5px;"></div>
                    </div>
                    <button onclick="changeAvatar()" style="width:100%; margin-bottom:5px;">
                        <i class="fas fa-camera"></i> ØªØºÙŠÙŠØ± Ø§Ù„ØµÙˆØ±Ø©
                    </button>
                    <button onclick="changeUsername()" style="width:100%;">
                        <i class="fas fa-edit"></i> ØªØºÙŠÙŠØ± Ø§Ù„Ø§Ø³Ù…
                    </button>
                </div>
                
                <!-- Ø¥Ø±Ø´Ø§Ø¯Ø§Øª Ø§Ù„Ø±ØªØ¨ -->
                <div class="sidebar-section">
                    <h3><i class="fas fa-info-circle"></i> Ù†Ø¸Ø§Ù… Ø§Ù„Ø±ØªØ¨</h3>
                    <div style="font-size: 13px; line-height: 1.6;">
                        <p><span class="role-badge role-owner">ğŸ† Ù…Ø§Ù„Ùƒ</span> - ÙŠØ±Ù‚Ù‘ÙŠ ÙˆÙŠÙƒØªÙ… ÙˆÙŠØ®ÙØ¶</p>
                        <p><span class="role-badge role-minister">ğŸ‘‘ ÙˆØ²ÙŠØ±</span> - ÙŠÙƒØªÙ… Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ ÙÙ‚Ø·</p>
                        <p><span class="role-badge role-member">ğŸ‘¤ Ø¹Ø¶Ùˆ</span> - Ù„Ø§ ØµÙ„Ø§Ø­ÙŠØ§Øª</p>
                        <p style="margin-top:10px; color:#666; font-size:12px;">
                            Ù„ØªØµØ¨Ø­ Ù…Ø§Ù„ÙƒØ§Ù‹: Ø³Ø¬Ù„ Ø¨Ø§Ø³Ù… "Ø§Ù„Ù…Ø§Ù„Ùƒ"
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© -->
            <div class="chat-area">
                <!-- Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ -->
                <div id="messages">
                    <div class="message system">
                        <div class="message-content">
                            ğŸŒŸ Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø§Ù„Ø´Ø§Øª Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ù…Ø¹ Ù†Ø¸Ø§Ù… Ø§Ù„Ø±ØªØ¨!
                            <br><small>Ø³Ø¬Ù„ Ø¨Ø§Ø³Ù… "Ø§Ù„Ù…Ø§Ù„Ùƒ" Ù„ØªØ­ØµÙ„ Ø¹Ù„Ù‰ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„ØªØ±Ù‚ÙŠØ© ÙˆØ§Ù„ÙƒØªÙ…</small>
                        </div>
                    </div>
                </div>
                
                <!-- Ù…Ø¤Ø´Ø± Ø§Ù„ÙƒØªØ§Ø¨Ø© -->
                <div class="typing-indicator" id="typingIndicator">
                    <span id="typingUser">Ù…Ø³ØªØ®Ø¯Ù…</span> ÙŠÙƒØªØ¨...
                </div>
                
                <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ -->
                <div class="input-area">
                    <div class="input-tools">
                        <button onclick="toggleFileUpload()" title="Ø¥Ø±Ø³Ø§Ù„ Ù…Ù„Ù">
                            <i class="fas fa-paperclip"></i>
                        </button>
                        <button onclick="toggleEmojiPicker()" title="Ø¥ÙŠÙ…ÙˆØ¬ÙŠ">
                            <i class="fas fa-smile"></i>
                        </button>
                        <button onclick="startRecording()" id="recordBtn" title="ØªØ³Ø¬ÙŠÙ„ ØµÙˆØª">
                            <i class="fas fa-microphone"></i>
                        </button>
                        <button onclick="showReplyTo()" title="Ø±Ø¯ Ø¹Ù„Ù‰ Ø±Ø³Ø§Ù„Ø©" id="replyBtn" style="display:none;">
                            <i class="fas fa-reply"></i>
                        </button>
                    </div>
                    
                    <div contenteditable="true" id="messageInput" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§..."></div>
                    
                    <button onclick="sendMessage()" id="sendBtn" style="padding:12px 25px;">
                        <i class="fas fa-paper-plane"></i> Ø¥Ø±Ø³Ø§Ù„
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ========== Ù†Ø§ÙØ°Ø© Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª ========== -->
    <div id="fileModal" class="modal" style="display:none;">
        <div class="modal-content">
            <h3><i class="fas fa-upload"></i> Ø±ÙØ¹ Ù…Ù„Ù</h3>
            <input type="file" id="fileInput" accept="image/*,video/*" multiple>
            <div id="filePreviewContainer" style="margin:15px 0;"></div>
            <button onclick="uploadFiles()" id="uploadBtn">
                <i class="fas fa-upload"></i> Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª
            </button>
            <button onclick="closeFileModal()" class="danger">
                <i class="fas fa-times"></i> Ø¥Ù„ØºØ§Ø¡
            </button>
        </div>
    </div>
    
    <!-- ========== Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØµÙˆØªÙŠ ========== -->
    <div class="recording-indicator" id="recordingIndicator">
        <div class="pulse-circle"></div>
        <div>
            <strong>ğŸ¤ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„...</strong>
            <div id="recordingTimer">00:00</div>
        </div>
        <button onclick="stopRecording()" class="danger" style="padding:8px 15px;">
            <i class="fas fa-stop"></i> Ø¥ÙŠÙ‚Ø§Ù
        </button>
    </div>

    <!-- ========== Ù…Ù„ÙØ§Øª Ø§Ù„ØµÙˆØª ========== -->
    <audio id="messageSound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-message-pop-alert-2354.mp3" type="audio/mpeg">
    </audio>
    <audio id="notificationSound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-correct-answer-tone-2870.mp3" type="audio/mpeg">
    </audio>
    <audio id="voiceMessageSound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-retro-game-emergency-alarm-1000.mp3" type="audio/mpeg">
    </audio>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        // ========== Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© ==========
        const socket = io();
        let currentUser = {
            username: '',
            avatar: 'ğŸ‘¤',
            avatarImage: null,
            id: null,
            role: 'member'
        };
        let mediaRecorder = null;
        let audioChunks = [];
        let recordingTimer = null;
        let recordingStartTime = null;
        let replyingTo = null;
        let soundEnabled = true;
        let notificationsEnabled = true;
        
        // ========== ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø© ==========
        document.addEventListener('DOMContentLoaded', function() {
            loadUserData();
            setupEventListeners();
            setupSocketEvents();
        });
        
        // ========== ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ==========
        function loadUserData() {
            const savedUser = localStorage.getItem('arabic_chat_user');
            if (savedUser) {
                const parsed = JSON.parse(savedUser);
                currentUser.username = parsed.username || 'Ø²Ø§Ø¦Ø±';
                currentUser.avatar = parsed.avatar || 'ğŸ‘¤';
                currentUser.avatarImage = parsed.avatarImage || null;
                currentUser.role = parsed.role || 'member';
                
                document.getElementById('usernameInput').value = currentUser.username;
                
                // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
                document.querySelectorAll('.avatar-option').forEach(opt => {
                    if (opt.dataset.avatar === currentUser.avatar) {
                        opt.classList.add('selected');
                    }
                });
                
                // Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø´Ø®ØµÙŠØ© Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø©
                if (currentUser.avatarImage) {
                    document.getElementById('previewImage').src = currentUser.avatarImage;
                    document.getElementById('avatarPreview').style.display = 'block';
                }
            }
        }
        
        // ========== Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø³ØªÙ…Ø¹ÙŠÙ† Ù„Ù„Ø£Ø­Ø¯Ø§Ø« ==========
        function setupEventListeners() {
            // Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø´Ø®ØµÙŠØ©
            document.querySelectorAll('.avatar-option').forEach(option => {
                option.addEventListener('click', function() {
                    if (this.id === 'customAvatarBtn') {
                        document.getElementById('avatarUploadInput').click();
                        return;
                    }
                    
                    document.querySelectorAll('.avatar-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    this.classList.add('selected');
                    currentUser.avatar = this.dataset.avatar;
                    currentUser.avatarImage = null;
                    document.getElementById('avatarPreview').style.display = 'none';
                });
            });
            
            // Ø±ÙØ¹ ØµÙˆØ±Ø© Ø´Ø®ØµÙŠØ© Ù…Ø®ØµØµØ©
            document.getElementById('avatarUploadInput').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file && file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        currentUser.avatarImage = e.target.result;
                        currentUser.avatar = 'ğŸ–¼ï¸';
                        
                        document.getElementById('previewImage').src = e.target.result;
                        document.getElementById('avatarPreview').style.display = 'block';
                        
                        document.querySelectorAll('.avatar-option').forEach(opt => {
                            opt.classList.remove('selected');
                        });
                        document.getElementById('customAvatarBtn').classList.add('selected');
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            // Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
            document.getElementById('messageInput').addEventListener('input', function() {
                if (this.textContent.trim()) {
                    socket.emit('typing');
                }
            });
            
            // Ø¥Ø±Ø³Ø§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±
            document.getElementById('messageInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
        }
        
        // ========== Ø£Ø­Ø¯Ø§Ø« Socket.io ==========
        function setupSocketEvents() {
            // Ø§Ù„Ø§ØªØµØ§Ù„
            socket.on('connect', () => {
                console.log('âœ… Ù…ØªØµÙ„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±');
                document.getElementById('connectionStatus').textContent = 'Ù…ØªØµÙ„';
                document.getElementById('connectionStatus').style.color = '#28a745';
                
                // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø¨ÙŠØ§Ù†Ø§Øª
                if (currentUser.username) {
                    setTimeout(() => {
                        completeLogin();
                    }, 500);
                }
            });
            
            // Ù‚Ø·Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„
            socket.on('disconnect', () => {
                document.getElementById('connectionStatus').textContent = 'ØºÙŠØ± Ù…ØªØµÙ„';
                document.getElementById('connectionStatus').style.color = '#dc3545';
            });
            
            // Ø§Ù„ØªØ±Ø­ÙŠØ¨
            socket.on('welcome', (data) => {
                console.log('Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ! Ø±ØªØ¨ØªÙƒ:', data.yourRole);
                currentUser.role = data.yourRole;
                updateRoleDisplay();
                updateUsersList(data.users);
                
                // Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
                data.history.forEach(msg => {
                    displayMessage(msg);
                });
                
                // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨
                const welcomeMsg = {
                    type: 'system',
                    user: 'Ø§Ù„Ù†Ø¸Ø§Ù…',
                    text: `ğŸŒŸ ${data.message} (Ø±ØªØ¨ØªÙƒ: ${getRoleName(data.yourRole)})`,
                    time: new Date().toLocaleTimeString('ar-SA')
                };
                displayMessage(welcomeMsg);
            });
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
            socket.on('users update', (users) => {
                document.getElementById('onlineCount').textContent = users.length;
                updateUsersList(users);
            });
            
            // Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯
            socket.on('user joined', (user) => {
                const joinMsg = {
                    type: 'system',
                    user: 'Ø§Ù„Ù†Ø¸Ø§Ù…',
                    text: `ğŸŸ¢ ${user.username} Ø§Ù†Ø¶Ù… Ù„Ù„Ø´Ø§Øª (${getRoleName(user.role)})`,
                    time: new Date().toLocaleTimeString('ar-SA')
                };
                displayMessage(joinMsg);
                playSound('notification');
            });
            
            // Ù…Ø³ØªØ®Ø¯Ù… ØºØ§Ø¯Ø±
            socket.on('user left', (user) => {
                const leaveMsg = {
                    type: 'system',
                    user: 'Ø§Ù„Ù†Ø¸Ø§Ù…',
                    text: `ğŸ”´ ${user.username} ØºØ§Ø¯Ø± Ø§Ù„Ø´Ø§Øª`,
                    time: new Date().toLocaleTimeString('ar-SA')
                };
                displayMessage(leaveMsg);
            });
            
            // Ø±Ø³Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©
            socket.on('new message', (message) => {
                displayMessage(message);
                
                // Ø¥Ø´Ø¹Ø§Ø± ØµÙˆØªÙŠ
                if (message.userId !== socket.id && soundEnabled) {
                    playSound('message');
                }
                
                // Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ù…ØªØµÙØ­
                if (notificationsEnabled && message.userId !== socket.id && document.hidden) {
                    showNotification(message.user, message.text || 'Ø£Ø±Ø³Ù„ Ù…Ù„Ù');
                }
            });
            
            // Ù…Ø¤Ø´Ø± Ø§Ù„ÙƒØªØ§Ø¨Ø©
            socket.on('user typing', (username) => {
                document.getElementById('typingUser').textContent = username;
                document.getElementById('typingIndicator').style.display = 'block';
                
                clearTimeout(window.typingTimeout);
                window.typingTimeout = setTimeout(() => {
                    document.getElementById('typingIndicator').style.display = 'none';
                }, 3000);
            });
            
            // ØªØ´ØºÙŠÙ„ ØµÙˆØª
            socket.on('play sound', (soundType) => {
                if (soundEnabled) {
                    playSound(soundType);
                }
            });
            
            // Ù…Ø³ØªØ®Ø¯Ù… ØªÙ… ÙƒØªÙ…Ù‡
            socket.on('user muted', (data) => {
                const msg = {
                    type: 'system',
                    user: 'Ø§Ù„Ù†Ø¸Ø§Ù…',
                    text: `ğŸ”‡ ${data.mutedBy} ÙƒØªÙ… Ù…Ø³ØªØ®Ø¯Ù…`,
                    time: new Date().toLocaleTimeString('ar-SA')
                };
                displayMessage(msg);
                playSound('notification');
            });
            
            // Ù…Ø³ØªØ®Ø¯Ù… ØªÙ… Ø¥Ù„ØºØ§Ø¡ ÙƒØªÙ…Ù‡
            socket.on('user unmuted', (userId) => {
                const msg = {
                    type: 'system',
                    user: 'Ø§Ù„Ù†Ø¸Ø§Ù…',
                    text: `ğŸ”Š ØªÙ… Ø¥Ù„ØºØ§Ø¡ ÙƒØªÙ… Ù…Ø³ØªØ®Ø¯Ù…`,
                    time: new Date().toLocaleTimeString('ar-SA')
                };
                displayMessage(msg);
            });
            
            // Ù…Ø³ØªØ®Ø¯Ù… ØªÙ… ØªØ±Ù‚ÙŠØªÙ‡
            socket.on('user promoted', (data) => {
                const msg = {
                    type: 'system',
                    user: 'Ø§Ù„Ù†Ø¸Ø§Ù…',
                    text: `ğŸ‰ ${data.promotedBy} Ø±Ù‚Ù‘Ù‰ ${data.username} Ù„ÙˆØ²ÙŠØ± ğŸ‘‘`,
                    time: new Date().toLocaleTimeString('ar-SA')
                };
                displayMessage(msg);
                playSound('notification');
                alert(`ğŸ‰ ØªÙ… ØªØ±Ù‚ÙŠØ© ${data.username} Ù„ÙˆØ²ÙŠØ±!`);
            });
            
            // Ù…Ø³ØªØ®Ø¯Ù… ØªÙ… Ø®ÙØ¶ Ø±ØªØ¨ØªÙ‡
            socket.on('user demoted', (data) => {
                const msg = {
                    type: 'system',
                    user: 'Ø§Ù„Ù†Ø¸Ø§Ù…',
                    text: `â¬‡ï¸ ${data.demotedBy} Ø®ÙØ¶ ${data.username} Ù„Ø¹Ø¶Ùˆ Ø¹Ø§Ø¯ÙŠ`,
                    time: new Date().toLocaleTimeString('ar-SA')
                };
                displayMessage(msg);
                playSound('notification');
            });
            
            // Ø®Ø·Ø£
            socket.on('error', (message) => {
                alert(message);
            });
        }
        
        // ========== Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ==========
        function completeLogin() {
            const username = document.getElementById('usernameInput').value.trim() || 'Ø²Ø§Ø¦Ø±';
            currentUser.username = username;
            currentUser.id = socket.id;
            
            // Ø¥Ø®ÙØ§Ø¡ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„
            document.getElementById('loginModal').style.display = 'none';
            
            // Ø¥Ø¸Ù‡Ø§Ø± ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø´Ø§Øª
            document.getElementById('chatApp').style.display = 'flex';
            
            // Ø¥Ø±Ø³Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ù„Ø³ÙŠØ±ÙØ±
            socket.emit('register user', currentUser);
            
            // Ø­ÙØ¸ ÙÙŠ localStorage
            localStorage.setItem('arabic_chat_user', JSON.stringify(currentUser));
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
            updateUserInterface();
            
            // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
            document.getElementById('messageInput').focus();
        }
        
        function updateUserInterface() {
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‡ÙŠØ¯Ø±
            document.getElementById('headerUsername').textContent = currentUser.username;
            updateAvatarDisplay(document.getElementById('headerAvatar'), currentUser);
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ
            document.getElementById('sidebarUsername').textContent = currentUser.username;
            updateAvatarDisplay(document.getElementById('sidebarAvatar'), currentUser);
        }
        
        function updateRoleDisplay() {
            const roleName = getRoleName(currentUser.role);
            const roleClass = getRoleClass(currentUser.role);
            
            document.getElementById('userRoleDisplay').textContent = roleName;
            document.getElementById('userRoleDisplay').className = `role-badge ${roleClass}`;
            
            document.getElementById('headerRole').textContent = roleName;
            document.getElementById('headerRole').className = `role-badge ${roleClass}`;
            document.getElementById('headerRole').style.display = 'inline-block';
            
            document.getElementById('sidebarRole').innerHTML = `<span class="role-badge ${roleClass}">${roleName}</span>`;
        }
        
        function getRoleName(role) {
            switch(role) {
                case 'owner': return 'ğŸ† Ø§Ù„Ù…Ø§Ù„Ùƒ';
                case 'minister': return 'ğŸ‘‘ Ø§Ù„ÙˆØ²ÙŠØ±';
                default: return 'ğŸ‘¤ Ø¹Ø¶Ùˆ';
            }
        }
        
        function getRoleClass(role) {
            switch(role) {
                case 'owner': return 'role-owner';
                case 'minister': return 'role-minister';
                default: return 'role-member';
            }
        }
        
        function updateAvatarDisplay(element, user) {
            if (user.avatarImage) {
                element.innerHTML = `<img src="${user.avatarImage}" alt="${user.username}">`;
            } else {
                element.textContent = user.avatar;
            }
        }
        
        function updateUsersList(users) {
            const usersList = document.getElementById('usersList');
            usersList.innerHTML = '';
            
            if (users.length === 0) {
                usersList.innerHTML = '<li style="text-align:center; color:#666;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ù…ØªØµÙ„ÙˆÙ†</li>';
                return;
            }
            
            users.forEach(user => {
                const li = document.createElement('li');
                
                const userInfo = document.createElement('div');
                userInfo.className = 'user-info';
                
                const avatarDiv = document.createElement('div');
                avatarDiv.className = 'user-avatar-small';
                updateAvatarDisplay(avatarDiv, user);
                
                const detailsDiv = document.createElement('div');
                detailsDiv.className = 'user-details';
                
                const nameRoleDiv = document.createElement('div');
                nameRoleDiv.className = 'user-name-role';
                
                const nameSpan = document.createElement('span');
                nameSpan.className = 'user-name';
                nameSpan.textContent = user.username;
                
                const roleSpan = document.createElement('span');
                roleSpan.className = `role-badge ${getRoleClass(user.role)}`;
                roleSpan.textContent = getRoleName(user.role).split(' ')[1];
                
                nameRoleDiv.appendChild(nameSpan);
                nameRoleDiv.appendChild(roleSpan);
                
                if (user.id === socket.id) {
                    const youSpan = document.createElement('span');
                    youSpan.style.cssText = 'font-size:10px; color:#666; margin-right:5px;';
                    youSpan.textContent = '(Ø£Ù†Øª)';
                    nameRoleDiv.appendChild(youSpan);
                }
                
                detailsDiv.appendChild(nameRoleDiv);
                
                if (user.promotedBy) {
                    const promotedSpan = document.createElement('span');
                    promotedSpan.className = 'promoted-by';
                    promotedSpan.textContent = `â†‘ Ø±ÙØ¹Ù‡: ${user.promotedBy}`;
                    detailsDiv.appendChild(promotedSpan);
                }
                
                userInfo.appendChild(avatarDiv);
                userInfo.appendChild(detailsDiv);
                
                const statusDiv = document.createElement('div');
                statusDiv.className = `user-status ${user.isMuted ? 'muted' : ''}`;
                statusDiv.title = user.isMuted ? 'Ù…ÙƒÙˆØª' : 'Ù†Ø´Ø·';
                
                userInfo.appendChild(statusDiv);
                
                li.appendChild(userInfo);
                
                // Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†
                if (user.id !== socket.id) {
                    const actionsDiv = document.createElement('div');
                    actionsDiv.className = 'user-actions';
                    
                    // Ø²Ø± Ø§Ù„Ø±Ø¯
                    const replyBtn = document.createElement('button');
                    replyBtn.innerHTML = '<i class="fas fa-reply"></i>';
                    replyBtn.title = 'Ø±Ø¯';
                    replyBtn.onclick = () => setReplyTo(user);
                    
                    // Ø²Ø± Ø§Ù„ÙƒØªÙ…/Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ÙƒØªÙ…
                    const muteBtn = document.createElement('button');
                    muteBtn.innerHTML = user.isMuted ? '<i class="fas fa-volume-up"></i>' : '<i class="fas fa-volume-mute"></i>';
                    muteBtn.title = user.isMuted ? 'Ø¥Ù„ØºØ§Ø¡ ÙƒØªÙ…' : 'ÙƒØªÙ…';
                    muteBtn.className = user.isMuted ? '' : 'danger';
                    muteBtn.onclick = () => toggleMuteUser(user.id, user.isMuted);
                    
                    actionsDiv.appendChild(replyBtn);
                    actionsDiv.appendChild(muteBtn);
                    
                    // Ø²Ø± Ø§Ù„ØªØ±Ù‚ÙŠØ© (ÙÙ‚Ø· Ù„Ù„Ù…Ø§Ù„Ùƒ ÙˆÙ„Ù„Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ø¹Ø§Ø¯ÙŠÙŠÙ†)
                    if (currentUser.role === 'owner' && user.role === 'member') {
                        const promoteBtn = document.createElement('button');
                        promoteBtn.innerHTML = '<i class="fas fa-crown"></i>';
                        promoteBtn.title = 'ØªØ±Ù‚ÙŠØ© Ù„ÙˆØ²ÙŠØ±';
                        promoteBtn.className = 'minister-btn';
                        promoteBtn.onclick = () => promoteUser(user.id, user.username);
                        actionsDiv.appendChild(promoteBtn);
                    }
                    
                    // Ø²Ø± Ø§Ù„Ø®ÙØ¶ (ÙÙ‚Ø· Ù„Ù„Ù…Ø§Ù„Ùƒ ÙˆÙ„Ù„ÙˆØ²Ø±Ø§Ø¡)
                    if (currentUser.role === 'owner' && user.role === 'minister') {
                        const demoteBtn = document.createElement('button');
                        demoteBtn.innerHTML = '<i class="fas fa-arrow-down"></i>';
                        demoteBtn.title = 'Ø®ÙØ¶ Ù„Ø¹Ø¶Ùˆ';
                        demoteBtn.className = 'danger';
                        demoteBtn.onclick = () => demoteUser(user.id, user.username);
                        actionsDiv.appendChild(demoteBtn);
                    }
                    
                    li.appendChild(actionsDiv);
                }
                
                usersList.appendChild(li);
            });
        }
        
        // ========== Ø¯ÙˆØ§Ù„ Ù†Ø¸Ø§Ù… Ø§Ù„Ø±ØªØ¨ ==========
        function promoteUser(userId, username) {
            if (confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ±Ù‚ÙŠØ© "${username}" Ù„ÙˆØ²ÙŠØ±ØŸ\n\nØ§Ù„ÙˆØ²ÙŠØ± Ø³ÙŠØªÙ…ÙƒÙ† Ù…Ù†:\nâ€¢ ÙƒØªÙ… Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ø¹Ø§Ø¯ÙŠÙŠÙ†\nâ€¢ Ù„Ø§ ÙŠÙ…ÙƒÙ† ÙƒØªÙ… Ø§Ù„Ù…Ø§Ù„Ùƒ Ø£Ùˆ ÙˆØ²Ø±Ø§Ø¡ Ø¢Ø®Ø±ÙŠÙ†`)) {
                socket.emit('promote to minister', userId);
            }
        }
        
        function demoteUser(userId, username) {
            if (confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ Ø®ÙØ¶ "${username}" Ù„Ø¹Ø¶Ùˆ Ø¹Ø§Ø¯ÙŠØŸ\n\nØ³ÙŠØ®Ø³Ø± ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„ÙˆØ²ÙŠØ±.`)) {
                socket.emit('demote minister', userId);
            }
        }
        
        function toggleMuteUser(userId, isMuted) {
            if (isMuted) {
                socket.emit('unmute user', userId);
            } else {
                if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ ÙƒØªÙ… Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŸ\n\nÙ„Ù† ÙŠØªÙ…ÙƒÙ† Ù…Ù† Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ø¦Ù„.')) {
                    socket.emit('mute user', userId);
                }
            }
        }
        
        // ========== Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ==========
        function displayMessage(message) {
            const messagesDiv = document.getElementById('messages');
            const msgDiv = document.createElement('div');
            
            let msgClass = 'message';
            if (message.userId === socket.id) {
                msgClass += ' own';
            } else if (message.userId) {
                msgClass += ' other';
            } else {
                msgClass += ' system';
            }
            
            if (message.type === 'reply') {
                msgClass += ' reply';
            }
            
            msgDiv.className = msgClass;
            
            let contentHTML = '';
            
            // Ø±Ø£Ø³ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
            if (message.userId) {
                contentHTML += `
                    <div class="message-header">
                        <div class="message-avatar">
                            ${message.avatarImage ? 
                                `<img src="${message.avatarImage}" alt="${message.user}">` : 
                                message.avatar}
                        </div>
                        <div class="message-user">
                            ${message.user}
                        </div>
                        <div class="message-time">${message.time}</div>
                    </div>
                `;
            }
            
            // Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
            contentHTML += '<div class="message-content">';
            
            // Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø±Ø³Ø§Ù„Ø©
            if (message.type === 'reply' && message.replyToUser) {
                contentHTML += `
                    <div class="message-reply">
                        <small>Ø±Ø¯ Ø¹Ù„Ù‰ ${message.replyToUser}</small>
                        ${message.replyText || ''}
                    </div>
                `;
            }
            
            // Ø§Ù„Ù†Øµ
            if (message.text) {
                contentHTML += `<div class="message-text">${message.text}</div>`;
            }
            
            // Ù…Ù„Ù
            if (message.type === 'file') {
                if (message.fileType === 'image') {
                    contentHTML += `
                        <div class="message-file">
                            <img src="${message.fileData}" alt="ØµÙˆØ±Ø©" class="file-preview" onclick="openImage('${message.fileData}')" style="cursor:pointer;">
                            <div class="file-info">
                                <i class="fas fa-image"></i>
                                <div>
                                    <div>${message.fileName}</div>
                                    <small>${message.fileSize}</small>
                                </div>
                            </div>
                        </div>
                    `;
                } else if (message.fileType === 'video') {
                    contentHTML += `
                        <div class="message-file">
                            <video src="${message.fileData}" controls class="file-preview"></video>
                            <div class="file-info">
                                <i class="fas fa-video"></i>
                                <div>
                                    <div>${message.fileName}</div>
                                    <small>${message.fileSize}</small>
                                </div>
                            </div>
                        </div>
                    `;
                }
            }
            
            // Ø±Ø³Ø§Ù„Ø© ØµÙˆØªÙŠØ©
            if (message.type === 'voice') {
                contentHTML += `
                    <div class="voice-message">
                        <div class="voice-player">
                            <button onclick="playVoiceMessage('${message.voiceId}')" style="padding:8px; border-radius:50%;">
                                <i class="fas fa-play"></i>
                            </button>
                            <div class="voice-duration">${formatTime(message.duration || 0)}</div>
                        </div>
                        <small>Ø±Ø³Ø§Ù„Ø© ØµÙˆØªÙŠØ© Ù…Ù† ${message.user}</small>
                    </div>
                `;
            }
            
            contentHTML += '</div>';
            
            // Ø§Ù„ØªØ§Ø±ÙŠØ®
            if (message.date) {
                contentHTML += `<div class="message-date">${message.date}</div>`;
            }
            
            msgDiv.innerHTML = contentHTML;
            messagesDiv.appendChild(msgDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }
        
        function sendMessage() {
            const messageInput = document.getElementById('messageInput');
            const text = messageInput.textContent.trim();
            
            if (!text && !replyingTo) return;
            
            if (replyingTo) {
                // Ø¥Ø±Ø³Ø§Ù„ Ø±Ø¯
                socket.emit('reply to message', {
                    text: text,
                    replyTo: replyingTo.id,
                    replyToUser: replyingTo.user
                });
                clearReply();
            } else {
                // Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø¹Ø§Ø¯ÙŠØ©
                socket.emit('send message', { text: text });
            }
            
            messageInput.textContent = '';
            messageInput.focus();
        }
        
        function setReplyTo(user) {
            replyingTo = { id: user.id, user: user.username };
            document.getElementById('replyBtn').style.display = 'block';
            document.getElementById('messageInput').placeholder = `Ø±Ø¯ Ø¹Ù„Ù‰ ${user.username}...`;
            document.getElementById('messageInput').focus();
        }
        
        function clearReply() {
            replyingTo = null;
            document.getElementById('replyBtn').style.display = 'none';
            document.getElementById('messageInput').placeholder = 'Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§...';
        }
        
        function showReplyTo() {
            if (replyingTo) {
                alert(`Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰: ${replyingTo.user}`);
            }
        }
        
        // ========== Ø§Ù„Ù…Ù„ÙØ§Øª ÙˆØ§Ù„ØµÙˆØ± ==========
        function toggleFileUpload() {
            const modal = document.getElementById('fileModal');
            modal.style.display = modal.style.display === 'flex' ? 'none' : 'flex';
        }
        
        function closeFileModal() {
            document.getElementById('fileModal').style.display = 'none';
            document.getElementById('fileInput').value = '';
            document.getElementById('filePreviewContainer').innerHTML = '';
        }
        
        function uploadFiles() {
            const fileInput = document.getElementById('fileInput');
            const files = fileInput.files;
            
            if (files.length === 0) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø£ÙˆÙ„Ø§Ù‹');
                return;
            }
            
            Array.from(files).forEach(file => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const fileData = {
                        type: file.type.startsWith('image/') ? 'image' : 'video',
                        data: e.target.result,
                        name: file.name,
                        size: formatFileSize(file.size)
                    };
                    
                    socket.emit('send file', fileData);
                };
                reader.readAsDataURL(file);
            });
            
            closeFileModal();
            playSound('notification');
        }
        
        function openImage(src) {
            window.open(src, '_blank');
        }
        
        // ========== Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØµÙˆØªÙŠ ==========
        async function startRecording() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream);
                audioChunks = [];
                
                mediaRecorder.ondataavailable = (event) => {
                    audioChunks.push(event.data);
                };
                
                mediaRecorder.onstop = () => {
                    const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
                    const reader = new FileReader();
                    
                    reader.onload = () => {
                        const duration = (Date.now() - recordingStartTime) / 1000;
                        
                        socket.emit('send voice', {
                            data: reader.result,
                            duration: duration
                        });
                        
                        // ØªÙ†Ø¸ÙŠÙ
                        stream.getTracks().forEach(track => track.stop());
                        audioChunks = [];
                    };
                    
                    reader.readAsDataURL(audioBlob);
                };
                
                // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„
                mediaRecorder.start();
                recordingStartTime = Date.now();
                
                // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¤Ø´Ø±
                document.getElementById('recordingIndicator').style.display = 'flex';
                document.getElementById('recordBtn').innerHTML = '<i class="fas fa-stop"></i>';
                document.getElementById('recordBtn').onclick = stopRecording;
                
                // Ø§Ù„Ù…Ø¤Ù‚Øª
                startRecordingTimer();
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„:', error);
                alert('ØªØ¹Ø°Ø± Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª.');
            }
        }
        
        function stopRecording() {
            if (mediaRecorder && mediaRecorder.state !== 'inactive') {
                mediaRecorder.stop();
                
                // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…Ø¤Ø´Ø±
                document.getElementById('recordingIndicator').style.display = 'none';
                document.getElementById('recordBtn').innerHTML = '<i class="fas fa-microphone"></i>';
                document.getElementById('recordBtn').onclick = startRecording;
                
                // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø¤Ù‚Øª
                stopRecordingTimer();
            }
        }
        
        function startRecordingTimer() {
            let seconds = 0;
            recordingTimer = setInterval(() => {
                seconds++;
                const minutes = Math.floor(seconds / 60);
                const secs = seconds % 60;
                document.getElementById('recordingTimer').textContent = 
                    `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            }, 1000);
        }
        
        function stopRecordingTimer() {
            if (recordingTimer) {
                clearInterval(recordingTimer);
                recordingTimer = null;
            }
            document.getElementById('recordingTimer').textContent = '00:00';
        }
        
        async function playVoiceMessage(voiceId) {
            socket.emit('get voice', voiceId, (voiceData) => {
                if (voiceData) {
                    const audio = new Audio(voiceData.data);
                    audio.play();
                }
            });
        }
        
        // ========== Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© ==========
        function playSound(type) {
            if (!soundEnabled) return;
            
            const sounds = {
                message: document.getElementById('messageSound'),
                notification: document.getElementById('notificationSound'),
                voice: document.getElementById('voiceMessageSound')
            };
            
            if (sounds[type]) {
                sounds[type].currentTime = 0;
                sounds[type].play().catch(e => console.log('Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª:', e));
            }
        }
        
        function toggleSound() {
            soundEnabled = !soundEnabled;
            document.getElementById('soundStatus').textContent = soundEnabled ? 'ğŸ”Š' : 'ğŸ”‡';
            playSound('notification');
        }
        
        function toggleNotifications() {
            notificationsEnabled = !notificationsEnabled;
            document.getElementById('notifStatus').textContent = notificationsEnabled ? 'ØªØ´ØºÙŠÙ„' : 'Ø¥ÙŠÙ‚Ø§Ù';
        }
        
        function showNotification(title, body) {
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification(title, { body: body, icon: 'https://arabic-chat.onrender.com/favicon.ico' });
            }
        }
        
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Ø¨Ø§ÙŠØª';
            const k = 1024;
            const sizes = ['Ø¨Ø§ÙŠØª', 'ÙƒÙŠÙ„ÙˆØ¨Ø§ÙŠØª', 'Ù…ÙŠØ¬Ø§Ø¨Ø§ÙŠØª', 'Ø¬ÙŠØ¬Ø§Ø¨Ø§ÙŠØª'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }
        
        function changeAvatar() {
            document.getElementById('avatarUploadInput').click();
        }
        
        function changeUsername() {
            const newName = prompt('Ø§Ø³Ù…Ùƒ Ø§Ù„Ø¬Ø¯ÙŠØ¯:', currentUser.username);
            if (newName && newName.trim()) {
                currentUser.username = newName.trim();
                socket.emit('update profile', currentUser);
                localStorage.setItem('arabic_chat_user', JSON.stringify(currentUser));
                updateUserInterface();
            }
        }
        
        function clearChat() {
            if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ØŸ')) {
                document.getElementById('messages').innerHTML = `
                    <div class="message system">
                        <div class="message-content">
                            ğŸ§¹ ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
                        </div>
                    </div>
                `;
            }
        }
        
        // Ø·Ù„Ø¨ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
        if ('Notification' in window && Notification.permission === 'default') {
            Notification.requestPermission();
        }
    </script>
</body>
</html>
