<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>شات متقدم - المحادثة</title>
    <link rel="stylesheet" href="chat.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="light">
    <div class="chat-container">
        <!-- الشريط الجانبي -->
        <aside class="sidebar">
            <div class="user-profile">
                <img id="current-profile-pic" class="profile-pic" 
                     src="" alt="الصورة الشخصية">
                <div class="profile-info">
                    <h3 id="current-username"></h3>
                    <span id="current-role" class="role"></span>
                </div>
            </div>
            
            <!-- قائمة المتصلين - قابلة للطي -->
            <div class="users-toggle" onclick="toggleUsersList('online')">
                <h3><i class="fas fa-users"></i> الأعضاء المتصلين</h3>
                <i class="fas fa-chevron-down"></i>
            </div>
            <div class="users-list" id="online-users-list">
                <!-- سيتم ملؤها بالجافاسكريبت -->
            </div>
            
            <!-- قائمة جميع الأعضاء - قابلة للطي -->
            <div class="users-toggle" onclick="toggleUsersList('all')" style="margin-top: 20px;">
                <h3><i class="fas fa-address-book"></i> جميع الأعضاء</h3>
                <i class="fas fa-chevron-down"></i>
            </div>
            <div class="users-list collapsed" id="all-users-list">
                <!-- سيتم ملؤها بالجافاسكريبت -->
            </div>
            
            <!-- الأزرار السريعة -->
            <div class="quick-actions" style="padding: 15px;">
                <button class="action-button" onclick="openThemeSelector()">
                    <i class="fas fa-palette"></i>
                    <span>الثيمات</span>
                </button>
                <button class="action-button" onclick="openSettings()">
                    <i class="fas fa-cog"></i>
                    <span>الإعدادات</span>
                </button>
                <button class="action-button" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>خروج</span>
                </button>
            </div>
        </aside>

        <!-- المنطقة الرئيسية -->
        <main class="main-content">
            <!-- رأس الشات -->
            <header class="chat-header">
                <div class="room-info">
                    <h2><i class="fas fa-hashtag"></i> الغرفة العامة</h2>
                    <p class="room-desc">محادثة عامة لجميع الأعضاء</p>
                </div>
                
                <div class="room-actions">
                    <button class="action-btn" id="toggle-sidebar" title="إظهار/إخفاء الأعضاء">
                        <i class="fas fa-users"></i>
                    </button>
                    <button class="action-btn" onclick="openProfileModal(currentUser.username)" title="بروفايلك">
                        <i class="fas fa-user"></i>
                    </button>
                    <button class="action-btn" onclick="showTopInteractions()" title="الأكثر تفاعلاً">
                        <i class="fas fa-trophy"></i>
                    </button>
                </div>
            </header>

            <!-- منطقة الرسائل -->
            <div class="chat-messages" id="chat-messages">
                <!-- الرسائل تظهر هنا -->
            </div>
            
            <!-- مؤشر الكتابة -->
            <div class="typing-indicator" id="typing-indicator" style="display: none;"></div>

            <!-- منطقة الإدخال -->
            <div class="chat-input-area">
                <div class="input-container">
                    <textarea id="message-input" class="message-input" 
                              placeholder="اكتب رسالتك هنا... (اضغط Enter للإرسال، @لذكر مستخدم)" 
                              rows="1"></textarea>
                    <button id="send-btn" class="send-btn" title="إرسال">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
                
                <!-- معاينة المرفقات -->
                <div class="media-attachments" id="media-attachments">
                    <!-- تظهر معاينات الملفات هنا -->
                </div>
                
                <!-- أزرار الإجراءات -->
                <div class="input-actions">
                    <button class="input-action" title="إرسال صورة">
                        <i class="fas fa-image"></i>
                    </button>
                    <button class="input-action" title="إرسال ملف">
                        <i class="fas fa-paperclip"></i>
                    </button>
                    <button class="input-action" title="تسجيل صوتي">
                        <i class="fas fa-microphone"></i>
                    </button>
                    <input type="file" id="file-input" accept=".pdf,.doc,.docx,.txt" style="display:none">
                </div>
            </div>
        </main>
    </div>

    <!-- أداة اختيار الثيم -->
    <div class="theme-selector" id="theme-selector">
        <h4 style="margin-bottom:10px;">اختر الثيم</h4>
        <div style="display:flex; flex-wrap:wrap; justify-content:center;">
            <div class="theme-option" style="background:#f8f9fa;" onclick="changeTheme('light')" title="فاتح"></div>
            <div class="theme-option" style="background:#212529;" onclick="changeTheme('dark')" title="داكن"></div>
            <div class="theme-option" style="background:linear-gradient(135deg,#667eea,#764ba2);" onclick="changeTheme('purple')" title="بنفسجي"></div>
            <div class="theme-option" style="background:linear-gradient(135deg,#f093fb,#f5576c);" onclick="changeTheme('pink')" title="وردي"></div>
            <div class="theme-option" style="background:linear-gradient(135deg,#4facfe,#00f2fe);" onclick="changeTheme('blue')" title="أزرق"></div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="chat.js"></script>
    <script>
        // وظائف إضافية
        function toggleUsersList(type) {
            const list = document.getElementById(`${type}-users-list`);
            const toggle = event.currentTarget;
            
            list.classList.toggle('collapsed');
            toggle.classList.toggle('collapsed');
        }
        
        function openThemeSelector() {
            const selector = document.getElementById('theme-selector');
            selector.classList.toggle('active');
        }
        
        function openSettings() {
            alert('شاشة الإعدادات قريباً...');
        }
        
        function showTopInteractions() {
            alert('قائمة الأكثر تفاعلاً قريباً...');
        }
        
        function logout() {
            if (confirm('هل تريد تسجيل الخروج؟')) {
                localStorage.removeItem('chatUser');
                localStorage.removeItem('chatTheme');
                window.location.href = 'index.html';
            }
        }
        
        // إغلاق القوائم عند النقر خارجها
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.theme-selector') && !e.target.closest('.action-button')) {
                document.getElementById('theme-selector').classList.remove('active');
            }
            if (!e.target.closest('.emoji-picker') && !e.target.closest('.input-action')) {
                document.getElementById('emoji-picker').classList.remove('active');
            }
        });
    </script>
</body>
</html>
